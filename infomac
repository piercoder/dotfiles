#!/bin/sh

#========================#
#      Colors
#========================#
ACCENT1='\033[38;2;232;51;28m'      # rosso #e8331c
ACCENT2='\033[38;2;104;193;86m'     # verde #68c156
ACCENT3='\033[38;2;241;211;43m'     # giallo #f1d32b
ACCENT4='\033[38;2;28;152;232m'     # blu #1c98e8
NC='\033[0m'
BOLD='\033[1m'

#========================#
#    System Information
#========================#
USER_INFO="$(whoami)@$(hostname)"
OS="$(sw_vers -productName) $(sw_vers -productVersion)"
KERNEL="$(uname -sr)"
UPTIME="$(uptime | sed 's/^.*up *//; s/,.*//' | sed 's/  / /g')"

#========================#
#     Hardware Info
#========================#
CPU_MODEL="$(sysctl -n machdep.cpu.brand_string)"
CPU_USAGE="$(ps -A -o %cpu | awk 'NR>1 {sum+=$1} END {printf("%.0f", sum)}')"
CPU="$CPU_MODEL (${CPU_USAGE}%)"

PAGE_SIZE=$(vm_stat | awk '/page size of/ {print $8}')
ACTIVE=$(vm_stat | awk '/Pages active/ {gsub(/\./,""); print $3}')
WIRED=$(vm_stat | awk '/Pages wired down/ {gsub(/\./,""); print $4}')
USED_MB=$(( (ACTIVE + WIRED) * PAGE_SIZE / 1024 / 1024 ))
TOTAL_MB=$(( $(sysctl -n hw.memsize) / 1024 / 1024 ))
RAM_PERC=$(( USED_MB * 100 / TOTAL_MB ))
USED_GIB=$(echo "scale=1; $USED_MB / 1024" | bc)
TOTAL_GIB=$(echo "scale=1; $TOTAL_MB / 1024" | bc)
MEMORY="$(printf "%s / %s GiB (%s%%)" "$USED_GIB" "$TOTAL_GIB" "$RAM_PERC")"

DISK_BLOCKS=$(df -k / | awk 'NR==2 {print $3, $2}')
DISK_USED_KB=$(echo "$DISK_BLOCKS" | awk '{print $1}')
DISK_TOTAL_KB=$(echo "$DISK_BLOCKS" | awk '{print $2}')
DISK_PERC=$(df -h / | awk 'NR==2 {print $5}')
DISK_USED_GIB=$(echo "scale=1; $DISK_USED_KB / 1048576" | bc)
DISK_TOTAL_GIB=$(echo "scale=1; $DISK_TOTAL_KB / 1048576" | bc)
DISK="$(printf "%s / %s GiB (%s)" "$DISK_USED_GIB" "$DISK_TOTAL_GIB" "$DISK_PERC")"

#========================#
#     Packages (brew)
#========================#
BREW_PACKAGES=$(brew list 2>/dev/null | wc -l | xargs)
CASK_PACKAGES=$(brew list --cask 2>/dev/null | wc -l | xargs)

#========================#
#     Network Info
#========================#
IP="$(ipconfig getifaddr en0 2>/dev/null || ipconfig getifaddr en1 2>/dev/null || echo "Unavailable")"

#========================#
#        Output
#========================#

echo ""
echo "                     ${ACCENT4}..'${NC}          ${BOLD}${ACCENT4}┌──────────── System ────────────┐${NC}"
echo "                 ${ACCENT4},xNMM.${NC}           ${ACCENT4}│${BOLD}${ACCENT1} User:${NC} $USER_INFO"
echo "               ${ACCENT4}.OMMMMo${NC}            ${ACCENT4}│${BOLD}${ACCENT1} OS:${NC} $OS"
echo "               ${ACCENT4}lMM\"${NC}               ${ACCENT4}│${BOLD}${ACCENT1} Kernel:${NC} $KERNEL"
echo "     ${ACCENT4}.;loddo:.  .olloddol;.${NC}       ${ACCENT4}│${BOLD}${ACCENT1} Uptime:${NC} $UPTIME"
echo "   ${ACCENT4}cKMMMMMMMMMMNWMMMMMMMMMM0:${NC}     ${ACCENT4}│${BOLD}${ACCENT1} Packages:${NC} ${BREW_PACKAGES} (brew), ${CASK_PACKAGES} (cask)"
echo " .${ACCENT4}KMMMMMMMMMMMMMMMMMMMMMMMWd.${NC}     ${BOLD}${ACCENT4}└────────────────────────────────┘${NC}"
echo " ${ACCENT4}XMMMMMMMMMMMMMMMMMMMMMMMX.${NC}       ${BOLD}${ACCENT4}┌─────────── Hardware ───────────┐${NC}"
echo "${ACCENT4};MMMMMMMMMMMMMMMMMMMMMMMM:${NC}        ${ACCENT4}│${BOLD}${ACCENT2} CPU:${NC} $CPU"
echo "${ACCENT4}:MMMMMMMMMMMMMMMMMMMMMMMM:${NC}        ${ACCENT4}│${BOLD}${ACCENT2} RAM:${NC} $MEMORY"
echo "${ACCENT4}.MMMMMMMMMMMMMMMMMMMMMMMX.${NC}        ${ACCENT4}│${BOLD}${ACCENT2} Disk:${NC} $DISK"
echo " ${ACCENT4}kMMMMMMMMMMMMMMMMMMMMMMMMWd.${NC}     ${BOLD}${ACCENT4}└────────────────────────────────┘${NC}"
echo " ${ACCENT4}'XMMMMMMMMMMMMMMMMMMMMMMMMMMk${NC}    ${BOLD}${ACCENT4}┌─────────── Network ────────────┐${NC}"
echo "  ${ACCENT4}'XMMMMMMMMMMMMMMMMMMMMMMMMK.${NC}    ${ACCENT4}│${BOLD}${ACCENT3} IP:${NC} $IP"
echo "    ${ACCENT4}kMMMMMMMMMMMMMMMMMMMMMMd${NC}      ${BOLD}${ACCENT4}└────────────────────────────────┘${NC}"
echo "     ${ACCENT4};KMMMMMMMWXXWMMMMMMMk.${NC}       "
echo "       ${ACCENT4}\"cooc*\"    \"*coo'\"${NC}         "
echo ""