#!/bin/sh

#========================#
#      Colors
#========================#
ACCENT='\033[38;2;28;152;232m'     # #1c98e8
LABEL='\033[38;2;241;211;43m'      # #f1d32b
NC='\033[0m'
BOLD='\033[1m'

#========================#
#    System Information
#========================#
USER_INFO="$(whoami)@$(hostname)"
OS="$(sw_vers -productName) $(sw_vers -productVersion)"
KERNEL="$(uname -sr)"
UPTIME="$(uptime | sed 's/^.*up *//; s/,.*//' | sed 's/  / /g')"

#========================#
#     Hardware Info
#========================#
CPU_MODEL="$(sysctl -n machdep.cpu.brand_string)"
CPU_USAGE="$(ps -A -o %cpu | awk 'NR>1 {sum+=$1} END {printf("%.0f", sum)}')"
CPU="$CPU_MODEL (${CPU_USAGE}%)"

PAGE_SIZE=$(vm_stat | awk '/page size of/ {print $8}')
ACTIVE=$(vm_stat | awk '/Pages active/ {gsub(/\./,""); print $3}')
WIRED=$(vm_stat | awk '/Pages wired down/ {gsub(/\./,""); print $4}')
USED_MB=$(( (ACTIVE + WIRED) * PAGE_SIZE / 1024 / 1024 ))
TOTAL_MB=$(( $(sysctl -n hw.memsize) / 1024 / 1024 ))
RAM_PERC=$(( USED_MB * 100 / TOTAL_MB ))
USED_GIB=$(echo "scale=1; $USED_MB / 1024" | bc)
TOTAL_GIB=$(echo "scale=1; $TOTAL_MB / 1024" | bc)
MEMORY="$(printf "%s / %s GiB (%s%%)" "$USED_GIB" "$TOTAL_GIB" "$RAM_PERC")"

DISK_BLOCKS=$(df -k / | awk 'NR==2 {print $3, $2}')
DISK_USED_KB=$(echo "$DISK_BLOCKS" | awk '{print $1}')
DISK_TOTAL_KB=$(echo "$DISK_BLOCKS" | awk '{print $2}')
DISK_PERC=$(df -h / | awk 'NR==2 {print $5}')
DISK_USED_GIB=$(echo "scale=1; $DISK_USED_KB / 1048576" | bc)
DISK_TOTAL_GIB=$(echo "scale=1; $DISK_TOTAL_KB / 1048576" | bc)
DISK="$(printf "%s / %s GiB (%s)" "$DISK_USED_GIB" "$DISK_TOTAL_GIB" "$DISK_PERC")"

#========================#
#     Packages (brew)
#========================#
BREW_PACKAGES=$(brew list 2>/dev/null | wc -l | xargs)
CASK_PACKAGES=$(brew list --cask 2>/dev/null | wc -l | xargs)

#========================#
#     Network Info
#========================#
IP="$(ipconfig getifaddr en0 2>/dev/null || ipconfig getifaddr en1 2>/dev/null || echo "Unavailable")"

#========================#
#        Output
#========================#

echo ""
echo "                     ..'          ${BOLD}${ACCENT}┌──────────── System ────────────┐${NC}"
echo "                 ,xNMM.           ${ACCENT}│${NC} ${LABEL}${BOLD}User:${NC}     ${ACCENT}$USER_INFO${NC}"
echo "               .OMMMMo            ${ACCENT}│${NC} ${LABEL}${BOLD}OS:${NC}       ${ACCENT}$OS${NC}"
echo "               lMM\"               ${ACCENT}│${NC} ${LABEL}${BOLD}Kernel:${NC}   ${ACCENT}$KERNEL${NC}"
echo "     .;loddo:.  .olloddol;.       ${ACCENT}│${NC} ${LABEL}${BOLD}Uptime:${NC}   ${ACCENT}$UPTIME${NC}"
echo "   cKMMMMMMMMMMNWMMMMMMMMMM0:     ${ACCENT}│${NC} ${LABEL}${BOLD}Packages:${NC} ${ACCENT}${BREW_PACKAGES} (brew), ${CASK_PACKAGES} (cask)${NC}"
echo " .KMMMMMMMMMMMMMMMMMMMMMMMWd.     ${BOLD}${ACCENT}└────────────────────────────────┘${NC}"
echo " XMMMMMMMMMMMMMMMMMMMMMMMX.       ${BOLD}${ACCENT}┌─────────── Hardware ───────────┐${NC}"
echo ";MMMMMMMMMMMMMMMMMMMMMMMM:        ${ACCENT}│${NC} ${LABEL}${BOLD}CPU:${NC}      ${ACCENT}$CPU${NC}"
echo ":MMMMMMMMMMMMMMMMMMMMMMMM:        ${ACCENT}│${NC} ${LABEL}${BOLD}RAM:${NC}      ${ACCENT}$MEMORY${NC}"
echo ".MMMMMMMMMMMMMMMMMMMMMMMX.        ${ACCENT}│${NC} ${LABEL}${BOLD}Disk:${NC}     ${ACCENT}$DISK${NC}"
echo " kMMMMMMMMMMMMMMMMMMMMMMMMWd.     ${BOLD}${ACCENT}└────────────────────────────────┘${NC}"
echo " 'XMMMMMMMMMMMMMMMMMMMMMMMMMMk    ${BOLD}${ACCENT}┌─────────── Network ────────────┐${NC}"
echo "  'XMMMMMMMMMMMMMMMMMMMMMMMMK.    ${ACCENT}│${NC} ${LABEL}${BOLD}IP:${NC}       ${ACCENT}$IP${NC}"
echo "    kMMMMMMMMMMMMMMMMMMMMMMd      ${BOLD}${ACCENT}└────────────────────────────────┘${NC}"
echo "     ;KMMMMMMMWXXWMMMMMMMk.       "
echo "       \"cooc*\"    \"*coo'\"         "
echo ""